{% extends "vote/base.html" %}
{% block title%}Decision Result for {{vide.video_title}}{% endblock%}
{% block content %}
<div class="w-full flex flex-col items-center space-y-6">
	<div class="text-start items-center w-full max-w-4xl mt-4 flex flex-row ">
		<a href="{% url 'index' %}" class="btn border-none bg-base-100 font-black text-lg md:text-2xl">&#8592;</a>
		<h1 class="text-2xl font-semibold text-primary-content font-videotitle break-all w-full truncate text-ellipsis whitespace-nowrap overflow-hidden min-w-0 tracking-wide">{{ video.video_title }}</h1>
	</div>
    <div class="w-full max-w-4xl">
		<div class="relative w-full aspect-video rounded-lg overflow-hidden">
			<div id="player"></div> <!--YouTube Player-->
			
		</div>
		<div class="flex flex-col sm:flex-row items-center justify-center gap-3 mt-4">
			<button 
			  onclick="restartClip()"
			  class="btn btn-wide rounded-full bg-white text-black font-semibold font-body text-lg hover:bg-gray-100">
			  🔁 Replay Clip
			</button>
		  
			<a href="{{ video.go_to_youtube }}" target="_blank"
			   class="link  rounded-full text-primary  font-medium">
			  🔗 Watch on YouTube ➤
			</a>
		  </div>
	</div>
    <div class="w-full max-w-4xl text-start space-y-1">
        
		<!--<h1 class="text-2xl font-semibold text-primary-content font-videotitle break-all w-full truncate text-ellipsis whitespace-nowrap overflow-hidden min-w-0">{{ video.video_title }}</h1>-->
		
        
        <div class="bg-transparent text-white rounded-lg shadow-lg border p-4 space-y-4">

            <div class="text-sm text-gray-300 border-b pb-2 flex justify-between">
                <span class="">{{ video.result.total_votes|default:"0" }} votes</span>
            </div>
			<div id="vote-section">
				{% if already_voted %}
				{% include "vote/partials/already_voted.html" %}
				{% else %}
				<form id="vote-form" hx-target="#vote-section" hx-post="{% url 'video_result' video.video_id%}" hx-swap='outerHTML'>
					{% csrf_token %}
					<div class="space-y-4 mb-4">
					<div class="flex space-x-2 checked:bg-base-200 focus-within:bg-base-200 checked:underline rounded-2xl">
						<input type="radio" name="vote" value="stroke" class="radio"/> 
						<span>✊ Stroke</span>
					</div>
					<div class="flex space-x-2 checked:bg-base-200 focus-within:bg-base-200 checked:underline rounded-2xl">
						<input type="radio" name="vote" value="let" class="radio"/> 
						<span>👆️ Let</span>
					</div>
					<div class="flex space-x-2 checked:bg-base-200 focus-within:bg-base-200 checked:underline rounded-2xl">
						<input type="radio" name="vote" value="nolet" class="radio"/> 
						<span>🫳 No Let</span>
					</div>
					</div>

					<button type="submit" class="btn rounded-4xl bg-primary text-primary-content text-md">Vote</button>
				</form>
				{% endif %}
			</div>
            
        </div>
    </div>
	
	<div class="max-w-4xl p-4 border w-full h-[60vh] mx-auto rounded-lg {% if not already_voted %}hidden{% endif %}" id="chart-container">
		<p class="text-xs text-center">Tap a bar to see vote count.</p>
		<canvas id="chart" class="w-full h-[400px]" video-id="{{ video.video_id }}"></canvas>
	</div>
    
	<!--Comment Section-->
<div class="w-full max-w-4xl p-4 items-center {% if not already_voted %} hidden {%endif%}" id="comment-section">
	<h2 class="text-xl font-semibold mb-4">Comments</h2>
  
	<!-- Comment Form -->
	<form hx-post="{% url 'post_comment' video.video_id %}" hx-swap="beforeend" hx-target="#comments" hx-on::after-request="this.reset()" class="mb-6 ">
		{% csrf_token %}
	  <textarea name="comment" rows="3" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring focus:border-blue-500 resize-none" placeholder="What are your thoughts on the decision?" required></textarea>
	  <div class="mt-2 flex justify-end">
		<button type="submit" class=" cursor-pointer bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Post</button>
	  </div>
	</form>

	<div id="comments" class="flex flex-col justify-between gap-4">
	{% if not video.comments.exists %}
	<p id="no-comment" class="text-gray-500">No comments yet... Don't be shy, start one 😆</p>
	{% else %}
	
	{% for comment in video.comments.all %}
		<div class="flex flex-col flex-1 border-b border-gray-600 py-4">
            {% include "vote/partials/comment_section.html" %}
        </div>
  {% endfor %}
  	
  {% endif %}
</div>	
</div>



{% endblock %}

{% block scripts %}

<script>
	document.addEventListener("DOMContentLoaded", () => {
		initYouTubeClip('{{ video.video_id }}', {{ start }});
	});
</script>

  
{% endblock %}
